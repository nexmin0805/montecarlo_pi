


<CUDA로 몬테카를로 알고리즘 구현하기>

1. 몬테카를로 알고리즘이란?
2. 몬테카를로 알고리즘을 이용하여 원주율 값 구하기
3. 병렬분산프로그래밍을 활용한 원주율 값 구하기
4. 결론













몬테카를로 알고리즘이란?
반복된 무작위 추출(repeated random sampling)을 이용하여 함수의 값을 수리적으로 근사하는 알고리즘을 부르는 용어이다. 수학이나 물리학 등에 자주 사용되며, 계산하려는 값이 닫힌 형식으로 표현되지 않거나 복잡한 경우에 근사적으로 계산할 때 사용된다.

몬테카를로 알고리즘을 이용하여 원주율 값 구하기

한 변의 길이가 1인 정사각형이 있다고 가정했을 때,
 
반지름이 1인 원을 4등분 한 원의 면적은 "π/4"이다.
원점(0, 0)에서 특정 점까지의 거리는 피타고라스 정리에 √(x^(2 )+  y^2   ) 으로 표시된다.
원점에서 특정 점까지의 거리가 1 이하면 원 이내에 있다는 것을 알 수 있다.
원의 넓이는 원점과의 거리가 1이하인 점들의 개수를 전체 점들의 개수로 나누어 구할 수 있다.
만약 100개의 다트를 던졌을 때 이 중 80개의 다트가 부채꼴 내부에 맞았다면 π/4 = 80/100 이 된다.
이때 π=3.2 이다. 실제 π의 값은 아니지만 실제값에 근사한 값인 것을 확인할 수 있다.
다트 n개를 던졌다고 가정하고, 이중 m개의 다트가 부채꼴 내부에 맞았다고 가정하면 
π=(4*m)/n이라는 식을 얻을 수 있다. 
즉, 한변의 길이가 1인 사각형 내부에 무작위 좌표의 점을 반복적으로 생성하고, 총 점의 개수와 부채꼴 내부의 점의 개수를 이용하여 π에 근사한 값을 얻을 수 있다.














10억개의 점을 찍었을 때의 코드이다. 소요시간 계산은 수업시간에 배운 gettimeofday함수를 사용하여 출력해주었다. 
위 프로그램을 실행하면 아래와 같은 결과를 얻을 수 있다. n은 점의 개수이다.

<n=1억: 1.787944초>
 




<n=10억: 18.286032초>
 

점의 숫자가 많아질수록 시간이 크게 늘어나는 것을 확인할 수 있었다.
이 프로그램을 cuda를 활용하면 시간을 단축시킬 수 있겠다고 생각하여 이 프로젝트를 시작하게 되었다.

3. 병렬분산프로그래밍을 활용한 원주율 값 구하기

-커널 함수
 
원점에서 점까지의 거리가 1보다 작거나 같으면 원 안에 찍힌 점이다.




shared memory를 사용할 때에는 꼭 syncthreads()함수를 사용해주어야 한다. 
shared memory는 global memory의 데이터를 캐시처럼 shared memory에 올린 뒤 사용한다. shared memory에 올리는 작업은 각각의 스레드가 수행한다. 이 때 syncthreads()함수를 사용하여 동기화를 해주지 않으면, 모두 shared memory에 올라오지 않은 상태에서 값을 참조하여 원하지 않는 값을 가져올수 있기 때문이다.


-벡터로 랜덤한 좌표 생성
 

-좌표값을 호스트에서 디바이스에 복사
 
cudaMalloc
첫 번째 인자: 할당할 메모리를 가리키는 포인터를 입력
두 번째 인자: 할당할 메모리의 크기를 입력

cudaMemcpy
첫 번째 인자: 복사할 목적지가되는 포인터로 cudaMemcpy() 함수로 할당한 그래픽 메모리의 포인터를 넣는다.
두 번째 인자: 복사할 소스가 되는 포인터로 PC에서 Malloc() 함수로 할당한 메모리의 포인터를 입력한다.

 CudaMemcpyHostToHost 	 PC 메모리에서 PC 메모리로 복사 
 CudaMemcpyHostToHoDevice	 PC 메모리에서 그래픽 카드로 복사 
 CudaMemcpyDeviceToHost	 그래픽 카드 메모리에서 그래픽 카드로 복사 
 CudaMemcpyDeviceToDevice	 그래픽 카드 메모리에서 그래픽 카드로 복사 



 



-점 100개
처음엔 점이 100개일때부터 시작했다. 점의 개수가 적은 이유로 pi의 값이 정확하지 않은 것을 확인할 수 있다. 또한 소요시간을 보면 GPU가 더 느린 것을 확인할 수 있다. 
 


-점 1000개
 3.14와 조금 더 가까운 값을 보여주고는 있지만, 아직도 CPU의 소요시간이 더 빠르다. 


-1000000개
 
지금부터는 CPU를 사용하는 것보다 GPU를 사용하는 것이 더 효율적인 것을 확인할 수 있었다.




-1억개
CPU의 소요시간은 약 2.3초 GPU의 소요시간은 약 0.3초로 2초정도 차이나고있다. 
또한 파이의 값이 실제 값과 매우 근사한 것을 확인 할 수 있다. 


-10억개
CPU의 소요시간은 22초로 훨씬 증가했지만, GPU의 소요시간은 3.4초로 1억개의 점을 찍었을 때보다 3.1초정도밖에 증가하지 않았다.
 


-15억개
 CPU의 소요시간은 약 30초, GPU의 소요시간은 약 5.2초로 25초정도 차이나고있다.
 



한변의 길이가 1인 정사각형에 점을 찍지만, 구역을 변들을 나누고 나눈 변들의 교차점에 점을 찍는 방식.

사각형을 백만 등분하고 100% 균일하게 점을 찍었을 때 1억까지 갈 필요도 없이 이미 소수 7번째 자리까지 정확한 값을 구할 수 있음.

또한 10배씩 범위를 증가시킴에 따라 정밀도가 약 10배씩 증가하는 것을 볼 수 있는데, 사각형을 10의 11제곱에서 12제곱수준의 값으로 나누어 점을 찍으면 소수점 열한자리까지의 정확한 결과를 얻을 수 있을것으로 예상.


